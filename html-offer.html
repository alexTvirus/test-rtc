<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>libdatachannel media example</title>
</head>
<body>

<p>Please enter the offer provided to you by the application: </p>
<textarea cols="50" rows="50"></textarea>
<button>Submit</button>

<script>
     rtc = new RTCPeerConnection({
            // Recommended for libdatachannel
            bundlePolicy: "max-bundle",
        });
     rtc.onconnectionstatechange = (state) => {
            console.log('State: ', rtc.connectionState);
        }

    rtc.onicegatheringstatechange = (state) => {
        console.log('State: ', rtc.iceGatheringState);
            if (rtc.iceGatheringState === 'complete') {
                // We only want to provide an answer once all of our candidates have been added to the SDP.
                let answer = rtc.localDescription;
                console.log(JSON.stringify(answer));
                // document.querySelector('textarea').value = JSON.stringify({"type": answer.type, sdp: answer.sdp});
                // document.querySelector('p').value = 'Please paste the answer in the application.';
                // alert('Please paste the answer in the application.');
            }
        }

        sendChannel = rtc.createDataChannel('sendDataChannel');

        sendChannel.onmessage = (event) => {
            console.log('onmessage: ', event);
        }

         sendChannel.onopen  = (event) => {

            console.log('onopen: ', sendChannel.readyState);
            sendChannel.send("ffwefefwef");
        }

        // tao offer
        const offerDescription =  rtc.createOffer();
        rtc.setLocalDescription(offerDescription);

    document.querySelector('button').addEventListener('click',   () => {

        let offer = JSON.parse(document.querySelector('textarea').value);
        
         rtc.setRemoteDescription(offer);

          
        // let media = await navigator.mediaDevices.getUserMedia({
        //     video: {
        //         width: 1280,
        //         height: 720
        //     }
        // });
        // media.getTracks().forEach(track => rtc.addTrack(track, media));
        // let answer =  rtc.createAnswer();
        // console.log(answer)
        //  rtc.setLocalDescription(answer);
    })
</script>

</body>
</html>
